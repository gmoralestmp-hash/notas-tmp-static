<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Notas TMP Regenerative</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#00b5ad" />
  <link rel="icon" href="icons/icon-192.png" />
  <style>
    :root{--c:#00b5ad}
    body{font-family:system-ui,sans-serif;background:#f8fafc;color:#222;margin:0}
    h1{text-align:center;color:var(--c);margin:16px 0}
    .card{background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);padding:16px;max-width:900px;margin:20px auto}
    button{background:var(--c);color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    button.secondary{background:#e6f7f6;color:#0d6662}
    input,textarea,select{border:1px solid #cfd6de;border-radius:8px;padding:8px;width:100%;font-size:14px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid3{display:grid;grid-template-columns:2fr 1fr 1fr;gap:8px}
    .line{border-top:1px solid #e5e7eb;margin:12px 0}
    .total{font-weight:700}
    .right{text-align:right}
    #msg{margin-top:10px;font-size:13px}
  </style>
</head>
<body>
  <h1>Notas de Remisi√≥n TMP Regenerative</h1>

  <div class="card">
    <h3>TMP Regenerative</h3>
    <p>
      Chihuahua, M√©xico<br>
      RFC: <b>MOVG850703SL4</b> ¬∑ Tel: <b>614 176 5850</b><br>
      Email: <a href="mailto:gmorales.tmp@gmail.com" style="color:#007c89;text-decoration:none;">gmorales.tmp@gmail.com</a>
    </p>
    <hr>

    <h3>Cliente</h3>
    <div class="grid2">
      <div>
        <label>Nombre</label>
        <input id="cliente" placeholder="Nombre del cliente">
      </div>
      <div>
        <label>Direcci√≥n</label>
        <input id="direccion" placeholder="Direcci√≥n del cliente">
      </div>
    </div>

    <hr>
    <h3>Conceptos</h3>
    <div id="items"></div>
    <button id="btnAddConcepto" type="button" onclick="addItem()">‚ûï Agregar concepto</button>

    <hr>
    <div class="grid2">
      <div>
        <label>Descuento (%)</label>
        <input type="number" id="descuento" value="0" min="0" max="100" oninput="calc()">
      </div>
      <div>
        <div class="right">
          <p>Subtotal (IVA incluido): <b id="subtotal">$0</b></p>
          <p>Descuento: -<span id="descMonto">$0</span></p>
          <p class="total">Total: <b id="total">$0</b></p>
        </div>
      </div>
    </div>

    <hr>
    <textarea id="notas" placeholder="Notas adicionales" rows="3" style="width:100%"></textarea>

    <div style="margin-top:15px;text-align:center">
      <button onclick="window.print()">üñ®Ô∏è Imprimir / Guardar PDF</button>
    </div>
    <div id="msg"></div>
  </div>

  <script>
    const mxn = new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"});
    const $ = (id)=>document.getElementById(id);
    const state={nota:{items:[]}};

    // === AGREGAR CONCEPTO ===
    function addItem(){
      const idx=state.nota.items.length;
      state.nota.items.push({id:Date.now()+idx,descripcion:'',cantidad:1,precio:0});
      const row=document.createElement('div');
      row.className='card';
      row.style.padding='8px';
      row.innerHTML=`
        <div class="grid3">
          <div><label>Descripci√≥n</label><input id="desc-${idx}" placeholder="Descripci√≥n"></div>
          <div><label>Cantidad</label><input type="number" id="cant-${idx}" value="1" min="1"></div>
          <div><label>Precio</label><input type="number" id="precio-${idx}" value="0" min="0"></div>
        </div>
        <div class="right" style="margin-top:5px">
          <b id="total-${idx}">$0</b>
          <button class="secondary" onclick="removeItem(${idx})">üóëÔ∏è</button>
        </div>`;
      $('items').appendChild(row);

      $('desc-'+idx).oninput=()=>{state.nota.items[idx].descripcion=$('desc-'+idx).value; calc();}
      $('cant-'+idx).oninput=()=>{state.nota.items[idx].cantidad=Number($('cant-'+idx).value||0); calc();}
      $('precio-'+idx).oninput=()=>{state.nota.items[idx].precio=Number($('precio-'+idx).value||0); calc();}
      calc();
    }
    window.addItem = addItem;

    // === BORRAR CONCEPTO ===
    function removeItem(i){
      state.nota.items.splice(i,1);
      renderItems();
      calc();
    }

    function renderItems(){
      $('items').innerHTML='';
      state.nota.items.forEach((it,i)=>{
        const row=document.createElement('div');
        row.className='card'; row.style.padding='8px';
        row.innerHTML=`
          <div class="grid3">
            <div><label>Descripci√≥n</label><input id="desc-${i}" value="${it.descripcion||''}"></div>
            <div><label>Cantidad</label><input type="number" id="cant-${i}" value="${it.cantidad}" min="1"></div>
            <div><label>Precio</label><input type="number" id="precio-${i}" value="${it.precio}" min="0"></div>
          </div>
          <div class="right" style="margin-top:5px">
            <b id="total-${i}">${mxn.format(it.cantidad*it.precio)}</b>
            <button class="secondary" onclick="removeItem(${i})">üóëÔ∏è</button>
          </div>`;
        $('items').appendChild(row);
        $('desc-'+i).oninput=()=>{state.nota.items[i].descripcion=$('desc-'+i).value; calc();}
        $('cant-'+i).oninput=()=>{state.nota.items[i].cantidad=Number($('cant-'+i).value||0); calc();}
        $('precio-'+i).oninput=()=>{state.nota.items[i].precio=Number($('precio-'+i).value||0); calc();}
      });
    }

    // === CALCULAR ===
    function calc(){
      let subtotal=0;
      state.nota.items.forEach((it,i)=>{
        const total=it.cantidad*it.precio;
        subtotal+=total;
        const el=$('total-'+i); if(el) el.textContent=mxn.format(total);
      });
      const desc=subtotal*(Number($('descuento').value||0)/100);
      const total=subtotal-desc;
      $('subtotal').textContent=mxn.format(subtotal);
      $('descMonto').textContent=mxn.format(desc);
      $('total').textContent=mxn.format(total);
    }

    // === INICIO ===
    window.onload=()=>{
      if(state.nota.items.length===0) addItem();
      calc();
    }
  </script>
</body>
</html>
